<div [class]="containerClasses()">
  <!-- Pendulum (for pendulum variant) -->
  @if (variant() === 'pendulum' && showVisualBeat()) {
    <div class="relative w-full h-24 flex items-end justify-center overflow-hidden">
      <div
        class="absolute bottom-0 w-1 h-20 bg-amber-600 rounded-full origin-bottom transition-transform duration-200"
        [style.transform]="'rotate(' + pendulumAngle() + 'deg)'"
      >
        <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-amber-500 shadow-lg"></div>
      </div>
      <div class="absolute bottom-0 w-16 h-2 bg-amber-800/50 rounded-t"></div>
    </div>
  }

  <!-- BPM Display -->
  <div class="flex items-center gap-2">
    @if (showBpmControl()) {
      <button
        type="button"
        class="w-8 h-8 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center transition-colors"
        [disabled]="disabled()"
        (click)="incrementBpm(-1)"
        title="Decrease BPM"
      >
        âˆ’
      </button>
    }

    <div class="text-center">
      <span [class]="bpmDisplayClasses()">{{ currentBpm() }}</span>
      <span class="block text-xs text-slate-500 uppercase tracking-wider">BPM</span>
    </div>

    @if (showBpmControl()) {
      <button
        type="button"
        class="w-8 h-8 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center transition-colors"
        [disabled]="disabled()"
        (click)="incrementBpm(1)"
        title="Increase BPM"
      >
        +
      </button>
    }
  </div>

  <!-- BPM Slider -->
  @if (showBpmControl()) {
    <input
      type="range"
      [value]="currentBpm()"
      (input)="onBpmInput($event)"
      min="20"
      max="300"
      step="1"
      class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"
      [disabled]="disabled()"
    />
  }

  <!-- Beat Indicators -->
  @if (showVisualBeat() && variant() !== 'pendulum') {
    <div class="flex items-center justify-center gap-2">
      @for (beat of beatIndicators(); track beat) {
        <div
          class="rounded-full transition-all duration-75"
          [class.w-4]="size() === 'sm'"
          [class.h-4]="size() === 'sm'"
          [class.w-5]="size() === 'md'"
          [class.h-5]="size() === 'md'"
          [class.w-6]="size() === 'lg'"
          [class.h-6]="size() === 'lg'"
          [class.bg-blue-500]="currentBeat() === beat && !accentFirstBeat()"
          [class.bg-amber-500]="currentBeat() === beat && accentFirstBeat() && beat === 1"
          [class.bg-green-500]="currentBeat() === beat && accentFirstBeat() && beat !== 1"
          [class.bg-slate-700]="currentBeat() !== beat"
          [class.scale-125]="currentBeat() === beat"
          [class.shadow-lg]="currentBeat() === beat"
        ></div>
      }
    </div>
  }

  <!-- Time Signature Selector -->
  @if (showTimeSignature()) {
    <div class="flex items-center gap-1 flex-wrap justify-center">
      @for (sig of timeSignatures; track sig) {
        <button
          type="button"
          class="px-2 py-1 rounded text-xs font-mono transition-colors"
          [class.bg-blue-600]="timeSignature() === sig"
          [class.text-white]="timeSignature() === sig"
          [class.bg-slate-700]="timeSignature() !== sig"
          [class.text-slate-300]="timeSignature() !== sig"
          [class.hover:bg-slate-600]="timeSignature() !== sig"
          [disabled]="disabled()"
          (click)="selectTimeSignature(sig)"
        >
          {{ sig }}
        </button>
      }
    </div>
  }

  <!-- Controls -->
  <div class="flex items-center gap-2">
    <button
      type="button"
      class="px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2"
      [class.bg-green-600]="!isPlaying()"
      [class.hover:bg-green-500]="!isPlaying()"
      [class.bg-red-600]="isPlaying()"
      [class.hover:bg-red-500]="isPlaying()"
      [class.text-white]="true"
      [disabled]="disabled()"
      (click)="toggle()"
    >
      @if (isPlaying()) {
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <rect x="5" y="4" width="3" height="12" rx="1"></rect>
          <rect x="12" y="4" width="3" height="12" rx="1"></rect>
        </svg>
        <span>Stop</span>
      } @else {
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"></path>
        </svg>
        <span>Start</span>
      }
    </button>

    <button
      type="button"
      class="px-4 py-2 rounded-lg font-medium bg-slate-700 hover:bg-slate-600 text-white transition-colors"
      [disabled]="disabled()"
      (click)="tapTempo()"
      title="Tap to set tempo"
    >
      TAP
    </button>
  </div>

  <!-- Tap indicator -->
  @if (tapTimes().length > 0) {
    <div class="text-xs text-slate-500">
      Tap {{ 3 - Math.min(tapTimes().length, 2) }} more times to set tempo
    </div>
  }
</div>

