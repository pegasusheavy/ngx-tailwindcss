<div [class]="containerClasses()">
  <!-- Time Display (Left) -->
  @if (showTime() && timePosition() === 'outside') {
    <span [class]="timeClasses()">{{ formatTime(currentTime()) }}</span>
  }

  <!-- Track Container -->
  <div
    #trackContainer
    [class]="trackContainerClasses()"
    (mousedown)="onMouseDown($event)"
    (mousemove)="onMouseMove($event)"
    (mouseleave)="onMouseLeave()"
    (touchstart)="onTouchStart($event)"
    role="slider"
    [attr.aria-valuenow]="currentTime()"
    [attr.aria-valuemin]="0"
    [attr.aria-valuemax]="duration()"
    [attr.aria-label]="'Seek slider'"
    [attr.tabindex]="disabled() ? -1 : 0"
    (keydown)="onKeyDown($event)"
  >
    <!-- Buffered Range -->
    @if (showBuffered() && buffered() > 0) {
      <div [class]="bufferedClasses()" [style.width.%]="(buffered() / duration()) * 100"></div>
    }

    <!-- Progress Fill -->
    <div [class]="progressClasses()" [style.width.%]="progressPercent()"></div>

    <!-- Chapter Markers -->
    @if (showMarkers()) {
      @for (marker of markers(); track marker.time) {
        <div
          [class]="markerClasses()"
          [style.left.%]="(marker.time / duration()) * 100"
          [attr.title]="marker.label"
        ></div>
      }
    }

    <!-- Hover Time Preview -->
    @if (showHoverPreview() && hoverPosition() !== null && !isDragging()) {
      <div
        class="absolute top-0 bottom-0 w-px bg-white/50 pointer-events-none"
        [style.left.%]="hoverPosition()! * 100"
      >
        <!-- Thumbnail Preview -->
        @if (showThumbnailPreview()) {
          <div [class]="thumbnailContainerClasses()" [style.bottom.px]="thumbnailOffset()">
            <!-- Individual thumbnail image -->
            @if (currentThumbnail() && !thumbnailSprite()) {
              <img
                [src]="currentThumbnail()!.url"
                [alt]="'Preview at ' + formatTime(hoverPosition()! * duration())"
                [class]="thumbnailImageClasses()"
                [style.width.px]="thumbnailWidth()"
                [style.height.px]="thumbnailHeight()"
                [style.borderRadius.px]="thumbnailBorderRadius()"
              />
            }

            <!-- Sprite sheet thumbnail -->
            @if (thumbnailSprite() && spritePosition()) {
              <div
                [class]="thumbnailImageClasses()"
                [style.width.px]="thumbnailWidth()"
                [style.height.px]="thumbnailHeight()"
                [style.borderRadius.px]="thumbnailBorderRadius()"
                [style.backgroundImage]="'url(' + thumbnailSprite()!.url + ')'"
                [style.backgroundPosition]="
                  spritePosition()!.x + 'px ' + spritePosition()!.y + 'px'
                "
                [style.backgroundSize]="
                  thumbnailSprite()!.frameWidth * thumbnailSprite()!.columns + 'px auto'
                "
              ></div>
            }

            <!-- Time label under thumbnail -->
            <div class="mt-1 px-2 py-0.5 bg-slate-900/90 text-white text-xs font-mono rounded">
              {{ formatTime(hoverPosition()! * duration()) }}
            </div>
          </div>
        } @else {
          <!-- Simple time preview (no thumbnail) -->
          <div [class]="hoverPreviewClasses()">
            {{ formatTime(hoverPosition()! * duration()) }}
          </div>
        }
      </div>
    }

    <!-- Thumb / Handle -->
    @if (showThumb()) {
      <div [class]="thumbClasses()" [style.left.%]="progressPercent()"></div>
    }

    <!-- Time Inside Track -->
    @if (showTime() && timePosition() === 'inside') {
      <div class="absolute inset-0 flex items-center justify-between px-2 pointer-events-none">
        <span [class]="timeInsideClasses()">{{ formatTime(currentTime()) }}</span>
        <span [class]="timeInsideClasses()">{{ formatTime(duration()) }}</span>
      </div>
    }
  </div>

  <!-- Time Display (Right) -->
  @if (showTime() && timePosition() === 'outside') {
    <span [class]="timeClasses()">
      @if (showRemaining()) {
        -{{ formatTime(duration() - currentTime()) }}
      } @else {
        {{ formatTime(duration()) }}
      }
    </span>
  }
</div>
