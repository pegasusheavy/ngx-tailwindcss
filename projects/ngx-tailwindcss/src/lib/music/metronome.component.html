<div [class]="containerClasses()">
  <!-- Pendulum (for pendulum variant) -->
  @if (variant() === 'pendulum' && showVisualBeat()) {
    <div class="relative w-full h-24 flex items-end justify-center overflow-hidden">
      <div
        class="absolute bottom-0 w-1 h-20 bg-amber-600 rounded-full origin-bottom transition-transform duration-200"
        [style.transform]="'rotate(' + pendulumAngle() + 'deg)'"
      >
        <div
          class="absolute -top-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-amber-500 shadow-lg"
        ></div>
      </div>
      <div class="absolute bottom-0 w-16 h-2 bg-amber-800/50 rounded-t"></div>
    </div>
  }

  <!-- BPM Display -->
  <div class="flex items-center gap-2">
    @if (showBpmControl()) {
      <button
        type="button"
        class="w-8 h-8 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center transition-colors"
        [disabled]="disabled()"
        (click)="incrementBpm(-1)"
        title="Decrease BPM"
      >
        âˆ’
      </button>
    }

    <div class="text-center">
      <span [class]="bpmDisplayClasses()">{{ currentBpm() }}</span>
      <span class="block text-xs text-slate-500 uppercase tracking-wider">BPM</span>
    </div>

    @if (showBpmControl()) {
      <button
        type="button"
        class="w-8 h-8 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center transition-colors"
        [disabled]="disabled()"
        (click)="incrementBpm(1)"
        title="Increase BPM"
      >
        +
      </button>
    }
  </div>

  <!-- BPM Slider -->
  @if (showBpmControl()) {
    <input
      type="range"
      [value]="currentBpm()"
      (input)="onBpmInput($event)"
      min="20"
      max="300"
      step="1"
      class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"
      [disabled]="disabled()"
    />
  }

  <!-- Beat Indicators with Accent Levels -->
  @if (showVisualBeat() && variant() !== 'pendulum') {
    <div class="flex flex-col items-center gap-2">
      <div class="flex items-center justify-center gap-2">
        @for (beat of beatIndicators(); track beat) {
          <button
            type="button"
            [class]="getAccentIndicatorClass(beat)"
            (click)="showAccentConfig() ? cycleAccent(beat) : null"
            [title]="
              showAccentConfig()
                ? 'Click to cycle accent: ' + getAccentForBeat(beat)
                : 'Beat ' + beat
            "
          ></button>
        }
      </div>

      <!-- Accent Legend (when config is shown) -->
      @if (showAccentConfig()) {
        <div class="flex items-center gap-3 text-[10px] text-slate-500">
          <span class="flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-slate-600"></span> None
          </span>
          <span class="flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-blue-600/60"></span> Soft
          </span>
          <span class="flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-amber-600/70"></span> Medium
          </span>
          <span class="flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-red-600"></span> Strong
          </span>
        </div>
      }
    </div>
  }

  <!-- Accent Pattern Presets -->
  @if (showAccentConfig() && availablePresets().length > 0) {
    <div class="flex flex-col gap-1">
      <span class="text-[10px] text-slate-500 uppercase tracking-wider">Pattern</span>
      <div class="flex items-center gap-1 flex-wrap justify-center">
        @for (preset of availablePresets(); track preset.name; let i = $index) {
          <button
            type="button"
            class="px-2 py-1 rounded text-xs transition-colors"
            [class.bg-blue-600]="selectedPresetIndex() === i"
            [class.text-white]="selectedPresetIndex() === i"
            [class.bg-slate-700]="selectedPresetIndex() !== i"
            [class.text-slate-300]="selectedPresetIndex() !== i"
            [class.hover:bg-slate-600]="selectedPresetIndex() !== i"
            [disabled]="disabled()"
            (click)="selectPreset(i)"
          >
            {{ preset.name }}
          </button>
        }
      </div>
    </div>
  }

  <!-- Time Signature Selector -->
  @if (showTimeSignature()) {
    <div class="flex items-center gap-1 flex-wrap justify-center">
      @for (sig of timeSignatures; track sig) {
        <button
          type="button"
          class="px-2 py-1 rounded text-xs font-mono transition-colors"
          [class.bg-blue-600]="timeSignature() === sig"
          [class.text-white]="timeSignature() === sig"
          [class.bg-slate-700]="timeSignature() !== sig"
          [class.text-slate-300]="timeSignature() !== sig"
          [class.hover:bg-slate-600]="timeSignature() !== sig"
          [disabled]="disabled()"
          (click)="selectTimeSignature(sig)"
        >
          {{ sig }}
        </button>
      }
    </div>
  }

  <!-- Controls -->
  <div class="flex items-center gap-2">
    <button
      type="button"
      class="px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2"
      [class.bg-green-600]="!isPlaying()"
      [class.hover:bg-green-500]="!isPlaying()"
      [class.bg-red-600]="isPlaying()"
      [class.hover:bg-red-500]="isPlaying()"
      [class.text-white]="true"
      [disabled]="disabled()"
      (click)="toggle()"
    >
      @if (isPlaying()) {
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <rect x="5" y="4" width="3" height="12" rx="1"></rect>
          <rect x="12" y="4" width="3" height="12" rx="1"></rect>
        </svg>
        <span>Stop</span>
      } @else {
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path
            d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"
          ></path>
        </svg>
        <span>Start</span>
      }
    </button>

    <button
      type="button"
      class="px-4 py-2 rounded-lg font-medium bg-slate-700 hover:bg-slate-600 text-white transition-colors"
      [disabled]="disabled()"
      (click)="tapTempo()"
      title="Tap to set tempo"
    >
      TAP
    </button>
  </div>

  <!-- Tap indicator -->
  @if (tapTimes().length > 0) {
    <div class="text-xs text-slate-500">
      Tap {{ 3 - Math.min(tapTimes().length, 2) }} more times to set tempo
    </div>
  }
</div>
